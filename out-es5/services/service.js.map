{"version":3,"sources":["../../out/services/service.js"],"names":["__awaiter","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","value","step","next","e","rejected","result","done","then","apply","Object","defineProperty","exports","maishu_chitu_service_1","require","Service","url","options","_super","create","ajax","get","headers","call","data","obj","code","message","Error","d","keys","i","length","key","k","toLowerCase","substr","travelJSON","isDateString","Date","stack","Array","push","item","pop","text","datePattern","datePattern1","match"],"mappings":"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","sourcesContent":["\"use strict\";\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst maishu_chitu_service_1 = require(\"maishu-chitu-service\");\r\nclass Service extends maishu_chitu_service_1.Service {\r\n    // static readonly LoginInfoStorageName = 'app-login-info'\r\n    // static loginInfo = new ValueStore<LoginInfo | null>(Service.getStorageLoginInfo())\r\n    // static applicationId: string | (() => string)\r\n    // static getStorageLoginInfo(): LoginInfo | null {\r\n    //     let loginInfoSerialString = this.getCookie(Service.LoginInfoStorageName)\r\n    //     if (!loginInfoSerialString)\r\n    //         return null\r\n    //     try {\r\n    //         let loginInfo = JSON.parse(loginInfoSerialString)\r\n    //         return loginInfo\r\n    //     }\r\n    //     catch (e) {\r\n    //         console.error(e)\r\n    //         console.log(loginInfoSerialString)\r\n    //         return null\r\n    //     }\r\n    // }\r\n    // protected static setStorageLoginInfo(value: LoginInfo | null) {\r\n    //     if (value == null) {\r\n    //         this.removeCookie(Service.LoginInfoStorageName)\r\n    //         return\r\n    //     }\r\n    //     this.setCookie(Service.LoginInfoStorageName, JSON.stringify(value), 1000)\r\n    // }\r\n    // private static setCookie(name: string, value: string, days?: number) {\r\n    //     // nodejs 没有 document\r\n    //     if (typeof document == 'undefined')\r\n    //         return;\r\n    //     var expires = \"\";\r\n    //     if (days) {\r\n    //         var date = new Date();\r\n    //         date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));\r\n    //         expires = \"; expires=\" + date.toUTCString();\r\n    //     }\r\n    //     document.cookie = name + \"=\" + (value || \"\") + expires + \"; path=/\";\r\n    // }\r\n    // private static getCookie(name: string) {\r\n    //     if (typeof document == 'undefined')\r\n    //         return null;\r\n    //     var nameEQ = name + \"=\";\r\n    //     var ca = document.cookie.split(';');\r\n    //     for (var i = 0; i < ca.length; i++) {\r\n    //         var c = ca[i];\r\n    //         while (c.charAt(0) == ' ') c = c.substring(1, c.length);\r\n    //         if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length, c.length);\r\n    //     }\r\n    //     return null;\r\n    // }\r\n    // private static removeCookie(name: string) {\r\n    //     // document.cookie = name + '=; expires=Thu, 01 Jan 1970 00:00:01 GMT;';\r\n    //     this.setCookie(name, '')\r\n    // }\r\n    ajax(url, options) {\r\n        const _super = Object.create(null, {\r\n            ajax: { get: () => super.ajax }\r\n        });\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            options = options || {};\r\n            options.headers = options.headers || {};\r\n            // if (Service.loginInfo.value)\r\n            //     options.headers['token'] = Service.loginInfo.value.token\r\n            // if (Service.applicationId)\r\n            //     options.headers['application-id'] = typeof Service.applicationId == 'function' ? Service.applicationId() : Service.applicationId\r\n            let data = yield _super.ajax.call(this, url, options);\r\n            if (data == null) {\r\n                return null;\r\n            }\r\n            let obj = data;\r\n            if (obj.code && obj.message) {\r\n                throw new Error(obj.message);\r\n            }\r\n            if (obj != null && obj['DataItems'] != null && obj['TotalRowCount'] != null) {\r\n                let d = {};\r\n                let keys = Object.keys(data);\r\n                for (let i = 0; i < keys.length; i++) {\r\n                    let key = keys[i];\r\n                    let k = key[0].toLowerCase() + key.substr(1);\r\n                    d[k] = obj[key];\r\n                }\r\n                data = d;\r\n            }\r\n            this.travelJSON(data);\r\n            return data;\r\n        });\r\n    }\r\n    /**\r\n     * 遍历 JSON 对象各个字段，将日期字符串转换为 Date 对象\r\n     * @param obj 要转换的 JSON 对象\r\n     */\r\n    travelJSON(obj) {\r\n        if (typeof obj === 'string' && this.isDateString(obj)) {\r\n            return new Date(obj);\r\n        }\r\n        else if (typeof obj === 'string') {\r\n            return obj;\r\n        }\r\n        var stack = new Array();\r\n        stack.push(obj);\r\n        while (stack.length > 0) {\r\n            var item = stack.pop();\r\n            for (var key in item) {\r\n                var value = item[key];\r\n                if (value == null)\r\n                    continue;\r\n                if (value instanceof Array) {\r\n                    for (var i = 0; i < value.length; i++) {\r\n                        stack.push(value[i]);\r\n                    }\r\n                    continue;\r\n                }\r\n                if (typeof value == 'object') {\r\n                    stack.push(value);\r\n                    continue;\r\n                }\r\n                if (typeof value == 'string' && this.isDateString(value)) {\r\n                    item[key] = new Date(value);\r\n                }\r\n            }\r\n        }\r\n        return obj;\r\n    }\r\n    isDateString(text) {\r\n        const datePattern = /\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}/;\r\n        const datePattern1 = /\\d{4}-\\d{2}-\\d{2}\\s+\\d{2}:\\d{2}/;\r\n        return text.match(datePattern) != null || text.match(datePattern1) != null;\r\n    }\r\n}\r\nexports.Service = Service;\r\n"],"file":"service.js"}